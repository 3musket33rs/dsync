<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: generator.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: generator.js</h1>

    


    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>(function () {
  'use strict';

  /**
   * Generator functions.
   *
   * &lt;p>They are actually a simple function which returns an {@link external:Iterator iterator} and can be implemented
   * in duck typing.&lt;/p>
   *
   * @example &lt;caption>function-star notation&lt;/caption>
   * function* generator() {
   *   yield 1;
   *   yield 2;
   *   yield 3;
   * }
   *
   * @example &lt;caption>Duck typing&lt;/caption>
   * function generator() {
   *   var i = 0;
   *   var content = [1, 2, 3];
   *   return {
   *     next : function () {
   *       var res;
   *       if (i &lt; content.length) {
   *         res = { done : false, value : content[i] };
   *       } else {
   *         res = { done : true };
   *       }
   *       i++;
   *       return res;
   *     }
   *   };
   * }
   *
   * @class Generator
   * @external
   * @see {@link https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/function* Generators on Mozilla Developer Network}
   */

  /**
   * An occurrence of a Generator.
   *
   * &lt;p>This is the result of calling a generator function which does &lt;code>yield&lt;/code> on each item it wants to
   * expose. It can actually be a hand made object as long as it respects the contract of this interface.&lt;/p>
   *
   * @example
   * function* generator() {
   *   yield 1;
   *   yield 2;
   *   yield 3;
   * }
   * var it = generator();
   *
   * @example
   * var it = (function () {
   *   var i = 0;
   *   var content = [1, 2, 3];
   *   return {
   *     next : function () {
   *       var res;
   *       if (i &lt; content.length) {
   *         res = { done : false, value : content[i] };
   *       } else {
   *         res = { done : true };
   *       }
   *       i++;
   *       return res;
   *     }
   *   };
   * })();
   *
   * @class Iterator
   * @external
   * @see {@link https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/The_Iterator_protocol The Iterator protocol on Mozilla Developer Network}
   */
  /**
   * Reads the next item on the iterator.
   *
   * &lt;p>Can either return a value if it is not done, &lt;code>{ done : false, value : 'some value' }&lt;/code>, or inform it
   * is done with &lt;code>{ done : true }&lt;/code>.&lt;/p>
   *
   * @returns Object a done marker or a value container.
   * @function external:Iterator#next
   */

  var skeleton = require('./skeleton');

  function updaterFromGenerator(generator) {
    function updater(item, done) {
      var iterator = generator();
      var result = iterator.next();
      while(!result.done) {
        item(result.value);
        result = iterator.next();
      }
      done();
    }

    return updater;
  }

  function newSummarizer(generator, serialize, digest, selector) {
    return skeleton.newSummarizer(updaterFromGenerator(generator), serialize, digest, selector);
  }

  function newResolver(generator, remote, serialize, deserialize) {
    return skeleton.newResolver(updaterFromGenerator(generator), remote, serialize, deserialize);
  }

  /**
   * Generator/Iterator handling.
   *
   * @module mathsync/generator
   */
  module.exports = {

    /**
     * Creates a new summarizer.
     *
     * @example &lt;caption>Yields items from an array.&lt;/caption>
     * var items = [{ from: 1, to: 2 }, { from: 2, to: 5}];
     * function* generator() {
     *   var i, l = items.length;
     *   for (i = 0; i &lt; l; i++) {
     *     yield items[i];
     *   }
     * }
     * function serialize(item) {
     *   return new Int32Array([item.from, item.to]).buffer;
     * }
     * var summarizer = require('mathsync/generator').newSummarizer(generator, serialize);
     *
     * @example &lt;caption>Yields strings from a hash.&lt;/caption>
     * var data = { key1: "value", key2: "other" };
     * var summarizer = require('mathsync/generator').newSummarizer(function* () {
     *   for (var k in data) {
     *     if (data.hasOwnProperty(k)) {
     *       yield k + ':' + data[k];
     *     }
     *   }
     * }, require('mathsync/string').newSerializer());
     *
     * @name module:mathsync/generator.newSummarizer
     * @function
     * @param {external:Generator} generator - the generator yielding local items.
     * @param {Serial~Serialize} serialize - the item serializer.
     * @param {Digest~Digester} [digester] - the digester to use, defaults to SHA-1.
     * @param {BucketSelector~Selector} [selector] - how to place items in IBF buckets, uses 3 buckets by default.
     */
    newSummarizer : newSummarizer,

    /**
     * Creates a new resolver.
     *
     * @example &lt;caption>Items from an array.&lt;/caption>
     * var remote = ...
     * var items = [{ from: 1, to: 2 }, { from: 2, to: 5}];
     * function* generator() {
     *   var i, l = items.length;
     *   for (i = 0; i &lt; l; i++) {
     *     yield items[i];
     *   }
     * }
     * function serialize(item) {
     *   return new Int32Array([item.from, item.to]).buffer;
     * }
     * function deserialize(buffer) {
     *   var arr = new Int32Array(buffer);
     *   return { from: arr[0], to: arr[1] };
     * }
     * var resolver = require('mathsync/generator').newResolver(generator, remote, serialize, deserialize);
     *
     * @name module:mathsync/generator.newResolver
     * @function
     * @param {external:Generator} generator - the generator yielding local items.
     * @param {Summarizer} remote - summarizer producing summaires of the remote side.
     * @param {Serial~Serialize} serialize - the item serializer.
     * @param {Serial~Deserialize} deserialize - the item deserializer.
     */
    newResolver : newResolver
  };
})();
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Modules</h3><ul><li><a href="module-mathsync.html">mathsync</a></li><li><a href="array.html">mathsync/array</a></li><li><a href="generator.html">mathsync/generator</a></li><li><a href="json.html">mathsync/json</a></li><li><a href="skeleton.html">mathsync/skeleton</a></li><li><a href="stream.html">mathsync/stream</a></li><li><a href="string.html">mathsync/string</a></li></ul><h3>Externals</h3><ul><li><a href="external-ArrayBuffer.html">ArrayBuffer</a></li><li><a href="external-Error.html">Error</a></li><li><a href="external-Generator.html">Generator</a></li><li><a href="external-Iterator.html">Iterator</a></li><li><a href="external-Promise.html">Promise</a></li><li><a href="external-Readable.html">Readable</a></li></ul><h3>Classes</h3><ul><li><a href="BucketSelector.html">BucketSelector</a></li><li><a href="Difference.html">Difference</a></li><li><a href="Digest.html">Digest</a></li><li><a href="Resolver.html">Resolver</a></li><li><a href="Serial.html">Serial</a></li><li><a href="Summarizer.html">Summarizer</a></li><li><a href="Summary.html">Summary</a></li></ul><h3>Events</h3><ul><li><a href="external-Readable.html#event:end">end</a></li><li><a href="external-Readable.html#event:error">error</a></li><li><a href="external-Readable.html#event:readable">readable</a></li></ul>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.0-alpha5</a> on Sat Jun 21 2014 11:46:51 GMT+0200 (CEST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
